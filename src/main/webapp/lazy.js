$(document).ready(function () {
	var readytable =  ".8........4.176..3...3.8..5.28....31...8.7...5...4....6......5.....31...2.15...4.\n" +
                ".875.29..9....1....3.....2.5.1.6..8..6.2.8.9.3..15.7..8..7...........67......9...\n" +
                "2....3..5.1...27...73.586.4.......6...24.7...4............2.8..86......15..7....3\n" +
                ".4..2...8..2..431..17..8.6..76..2.8............8...2....9.6374....8.9........7..1\n" +
                "...7.......4.5..2.5..8.17.6....2.....475....3.854.6...8...3....7.6.....5..218....\n" +
                "....49...3.5...2.4...3.8.5...3.....8...9714.......5......4..8.12...9.7..4....75..\n" +
                ".59.....76.........7..6.2.3...3.512.9............16........2.3.3..5.876..15...8..\n" +
                "2..1.74.3.6..5.28.3.....7...5.2...4..7.5.....8...3..2..4..2..7....41........86...\n" +
                "32.4..6.1..5..6....168...9.......9.....2.3.....25.43.8...1..2.3......45..5....1..\n" +
                "61..4..5..57..9....4.2....77.16.2.4..6.7.1..5.854.......8.2..1........84.........\n" +
                ".4.1...7.....62...1....9.5.21..5......58.1.4.7........8.9.....5...6....767298....\n" +
                "....8....4.6.........3.....8..75..34...89..7..5..4...6..3.7..6954..6.8..6.9..8..2\n" +
                "4..89..5.....7.....82.34..1......98....2..5.7.7.....32.......1....7532.4...9.8...\n" +
                "......2.6......58.....92.1..82..1.6...4.5....1.5..9..3.9..4..2......8.3....1..6..\n" +
                "..5...7.8.1.5.26..3....79.....9...1.5...1..9.....53...96.8....5.....1.6.1...9..8.\n" +
                "..7.94..6.2376.......38...........4.918.7.......6..8.........19.4...3.7.........8\n" +
                "4.6.38......9..3...5..4.........317..4..6......3...69.1...87....9.1..5...8.......\n" +
                "3..1...5....48.6.2.1.....3..37.4.......31......25....7...27......5......7....8.6.\n" +
                ".2..14.9.6....72.17....5..3.4......6.6....3.5.31.2.7......7.9.....5.....3.......2\n" +
                "2...8.....49.3....7...24..6..4..86..6..3...48.935..7...5..........2.789.9........\n" +
                "..147....39.................67.9..43....3.6..54.76.1...1....7..4..2.3.5....9..4.6\n" +
                "7.....9.2.4..3..........34..2..1............73..75.1...81.9.4..5..3...7.9..5.8.1.\n" +
                ".8134.....6.5..4...39.2...5........9.1......42.6........8.1.356.25..6.98...8.....\n" +
                ".4........26.9...5517..........461.....82.65...49.72.8.78.6.............265..4..7\n" +
                "..7.6..85..5.9.16..........4..7...5.26.4.8.1...9.......2...7......64....85.......\n" +
                "3..89.1.2..93.4.8.48.....7....6..4.....1...6..9....2.....9.3..6.2..1.39........24\n" +
                "...4..3.......9.....45.......58.39..26.....8.9...7...66..3.48...436....2.7..52...\n" +
                "9.8....15..3.5.....6.1.24..............923..8...6..9..15.268......4.12...9...5...\n" +
                ".6.....83.4..25.6..928.....2....1..4.8.6......14....58...2.....35..6......81.4...\n" +
                ".7.864.5..5........9852.4.....35.9....9....82...2.8..5........67...86..3..3...7..\n" +
                "...8....9.41.....7..........6..21...9.........283.7...8...1..23....9..7.6.74..91.\n" +
                "....2....28...5....4.38.1....6...8...7.....6....1.3....174.....4..816..56.5......\n" +
                "......5898..1.....79...2..3....2.....1...3.52..876...1......97..2..3.1.....9.8..6\n" +
                "9..1...8..7..4519.5...69...4.3.9......8...7.316...89.....3......49....6..........\n" +
                "....1.8...9...7..226....9...87.....1.147................56.........2...8...1.8297\n" +
                ".....7...2..3....9..5...8.....2..6.3.....9......135.9..286.........287.6..79.3..5\n" +
                "..6........27.....5..1.....187.2........8.2.....46..7.....3.54.8..2....33.58..16.\n" +
                "....1.9........3.8.9...7.6.......6.4..9...7....8.54.....3.78.4..1..4..96.856.9...\n" +
                ".....2..67..6............9..3.9....5....4.3.........78......4.79..8.5.3.256..7..9\n" +
                ".............5.4.13..91.5..2.75...4........8.9..723....5....2...9......5.4....379\n" +
                "6....5.2..7.......9....4..5....73916..6.29..3..........6.....347..4..1.25..9...6.\n" +
                ".59..2.1661..5......4.......2.98..65.6.5..14.4...139...82......3.......2.9.....5.\n" +
                ".....94.5..2.....75..4...1..59...8.4..6.........14..9....918.76...57..........2..\n" +
                ".5..6..4....2.8.6...8..51.9...5.2..749.7....52..4.6...9..821...5....4.9..........\n" +
                "..6.3....9..1.237....7.95..........6..1.7....8....1....6.2....8..3.9..5..9..13...\n" +
                "..1.9....6..4....7....3........59.3...87...6...3...5197...8...48.6..19.......4...\n" +
                "4..71.5.3..5.6.8....72.31..513.7...2......6..2......1....5...34......2.....8...6.\n" +
                "...4.12......3.........5.7.6..8...3......3....1..2..863.7.....1....1.46..5.2.....\n" +
                "7..9..8...95..8....1.7............384...52.9.97..4..5..8....7.2...1.....2.......9\n" +
                "....53....6.........3.7.8.67.8...645........7425.....3.5.....7...69...5..89...2..\n" +
                ".89....4...6.1..........15.6...24.....85..4.......8.7.7..169..5...8...9......72..\n" +
                "2..........9...6..356..8.....58.614....4...3..8.1..2...4....8.25.......41...3.9..\n" +
                "..5236..7...7.....36...58.....3.87....29.....84.52.6...38...2...968...........5..\n" +
                "..9.....152..3....781...9....7....93.15.....6......7..16..73..2..2..8......5.2.68\n" +
                "...........14..7...3......515....3.67.2.5..4......71...2.9.6.......714.....34.6..\n" +
                "....7..2.63.1............48...3...1..5...67....478...62..4..87.........4..3...1.2\n" +
                ".9.....8..1.47..3....2..5...59..8...324....7....3.5.29...8.215.............5...43\n" +
                "4.....6.....1.........7...5.1.85..6.5.4.....89.6.4...7.....13..87.9....4.....3.5.\n" +
                "..91.....6..4...1.4....8..79..2.68...6..15...5...79..1....8.6..2.4....7.7...5....\n" +
                "238...7...7.....2...1.....6.17.........3......6.5..9711.3....52......3...85..2.67\n" +
                ".5.............28...61....4...5...19.7.......9.1.627....9...4.6..7...1..58..2..9.\n" +
                ".....23.8..3...9...9....2.1.28..1...4.1.97...7..8.......432819......548.........5\n" +
                ".582.1.7...4.5..6.6....715......2......8....4.976.....9....6.1..6.12.5.....7.....\n" +
                "9.........7.2....11...6.47.....49..5......3.......7.19..7..3...5..19...4...5..6..\n" +
                "..7.3.69....9.5....2.6....3175.....2...3....7.6.......5.....37...6..9...2.98.....\n" +
                "9.4.8.5..8.6....7.37....96.4..56...2...37...56.5.98.3..........5.....7.97.9.....6\n" +
                "7.6...9...1.859..............3...82.6....7.....93......9...3..1....8.7.5.5.2..38.\n" +
                "..7.32.9.23...........64..8........6.82.43..9.....8....4....57..738.5..2..5......\n" +
                "7...26..8...43.6...34....9221.....763.........8..67.2....8............4.12.7...6.\n" +
                "....53......74.8...........4..1.7..2.184....9..9..8..5.9.3...1.17...93...4.5...9.\n" +
                "3......84..7.6....8.9.....6..3...5.8...9.....62.8...4375..96.2...25......9..8....\n" +
                "............6.....678..1...3.4..56...6..48.5....76...45....4..1.3..5.8.79..1.3...\n" +
                "2..7....4......983......2...7.4.......5....4138..9...5....31...9.78.4.1....97.5..\n" +
                ".1.2..57.4.3....218.....3........43..4..78.5..8..2....7...519.........15..2......\n" +
                ".6.875.....3.4...7.9.......48....1..1......9...5....6.....5.7.4..8.36...51...4...\n" +
                "2.4....3.........8......4299.3.8.2...7..45....2..6.7..39.6...4.6.8....7.5....89.2\n" +
                "7..2..4......8......8..1..2.7..4..1..9...........1.85.5..8.4.3.1.2..5.7.........9\n" +
                "9..5.3..6.5..8....3.41...2...9...6.3.....9...423..68.11.....4.5....4......6......\n" +
                ".4.2...81....5....19.8...........9.2.5.......9...17.35..7.2.543.8..........4....7\n" +
                "38..4...5.64.1....7.5..36.....9.7.........98.......1...4....7.3.3.....16..78...5.\n" +
                ".5......6.1.....9.3.81...4..9..7.....3.4.1.......8...7967.........8.6..5..57...1.\n" +
                ".9.........5.463..67.3..9.2..6.....5............2..1.6...1.2.4.7..5.9..3.296..71.\n" +
                "2..6....13...1..7.8.72...9.9..8...2...........5...9...13.....58...36.71..62....39\n" +
                "6...957.....8.....8.....5.1..14...8.9...58....4.......5..31...6....679.....5.....\n" +
                ".68.3.2...9..5......3.....74......96......5.8.76....23.3....6.58...26..9....8..7.\n" +
                "...9..68..6..875..1.......2...5..1....5....97672......89.61.2.5.......7.3........\n" +
                "2....4..7.58...2.3...9...6..962......2.5...................2.54.7.3.5..8....476..\n" +
                "3..7.86.2...9..1.3..........1...6.5.6.8.293..5.9.71..8......5.....63........8..1.\n" +
                ".78..4..16....1..4..9..83...6.2..1....1....8..829..6......4...6.....247...67.9...\n" +
                "......9.7...14.6....48.7.....2.8.....485..2.6.9.6...7.....72..19...........9.14..\n" +
                "...2....4.2..14..5..4.56...2831.....7...6.5...51........5...2..37.6.8...81......7\n" +
                "......2......2....9..8.7...1...5..87..6..2..474...69.1...1.....4.1..9.......6.1.8\n" +
                "1...5.4.69537.68..8..1.........3.5.7.3....6............9.6....44.7.15...68....95.\n" +
                "...649.3.........9....2..7.2....45..4.9..5..3.....7.26.....2.673...1.94.6...9.3..\n" +
                "......4.6.8.25.1..41.8...53....2..1..4.....3...713.6.2........7......86.63...8...\n" +
                "........956....8...81.69.2......1938...35.6............9..8...24...9.........65.4\n" +
                "...7.....3..........41...6.29.4....5..1..274....67....7...6.9.4.3.5....61.9.4..7.\n" +
                "..13...6.2..78....354..6.......547..4........67.......1..2..8.4....312.7......63.\n" +
                ".......75.8.4....29...1.8..6.....1547.2.......4.6....7..1...6..5...9..4.2.......1\n" +
                ".95..327...1.9..5..2.5...6.6..7.5.414...6..2.9.....5.......6...............271.9.\n";
	
	var readytablearr = readytable.split("\n");
	
	$("input").on("paste",false); //no copy-paste 
	$("input").on("keydown",function(e){
	if (e.which == 8) {
		return true;
	} else if ($(e.target).val().length > 0 ) {	//only 1 number here
		e.stopPropagation;
		return false;
	} else if (e.which == 69 || e.which == 189) {
		e.stopPropagation;
		return false;
	} else {
		return true;
	}
	}); 
	
	$("input").on("input",function(e) {
		var t = $("table input");
			
		for (var i = 0; i < 81; i++) {
				
			$(t[i].parentElement).addClass("notouch");
			var block = $("." + t[i].parentElement.classList.item(4) + ":not(.notouch)").find("input");
			var line = $(t[i].parentElement.parentElement).find("td:not(.notouch)").find("input");
			var column = $("tr").find("td:nth-child("+(i%9+1)+"):not(.notouch)").find("input");
			var licznik = 0;
			
			
			for (var j = 0; j < 8; j++) {	
			 	if ($(t[i]).val() !== "" && $(t[i]).val() == $(block[j]).val()) {
					licznik++;
					
				}
				else if ($(t[i]).val() !== "" && $(t[i]).val() == $(line[j]).val()) {
					licznik++;
					

				}
				else if ($(t[i]).val() !== "" && $(t[i]).val() == $(column[j]).val()) {
					licznik++;
				}
				
			} 
			if (licznik > 0) {	
				$(t[i]).css("background-color","lightcoral");
			} else {
				if ($(t[i]).prop("disabled")==true) {
					$(t[i]).css("background-color","#EBEBE4");
				} else {
					$(t[i]).css("background-color","white");
				}
			}
			
			
			$(t[i].parentElement).removeClass("notouch");
		}
	});
		$("button#generate").on("click",function(){
			var t = $("table input");
			var puzzle = readytablearr[Math.floor((Math.random() * 10) + 1)].split("");
				
			for (var i = 0; i < 81 ; i++) {
				$(t[i]).prop("disabled",false);
				$(t[i]).val("");
					if (puzzle[i] != ".") {
						$(t[i]).val(puzzle[i]);	
						$(t[i]).prop("disabled",true);
					}
				
			}
			
			for (var i = 0; i < 81; i++) {
				
			$(t[i].parentElement).addClass("notouch");
			var block = $("." + t[i].parentElement.classList.item(4) + ":not(.notouch)").find("input");
			var line = $(t[i].parentElement.parentElement).find("td:not(.notouch)").find("input");
			var column = $("tr").find("td:nth-child("+(i%9+1)+"):not(.notouch)").find("input");
			var licznik = 0;
			
			
			for (var j = 0; j < 8; j++) {	
			 	if ($(t[i]).val() !== "" && $(t[i]).val() == $(block[j]).val()) {
					licznik++;
					
				}
				else if ($(t[i]).val() !== "" && $(t[i]).val() == $(line[j]).val()) {
					licznik++;
					

				}
				else if ($(t[i]).val() !== "" && $(t[i]).val() == $(column[j]).val()) {
					licznik++;
				}
				
			} 
			if (licznik > 0) {	
				$(t[i]).css("background-color","lightcoral");
			} else {
				if ($(t[i]).prop("disabled")==true) {
					$(t[i]).css("background-color","#EBEBE4");
				} else {
					$(t[i]).css("background-color","white");
				}
			}
			
			
			$(t[i].parentElement).removeClass("notouch");
			}
			
		})

});